# 生信编程直播第10题-根据指定染色体及坐标得到位置信息

## 题目

这个题目是来源于生信编程直播学员的真实需求！当然，我也遇到过这个需求：[一个基因坐标定位到具体基因的程序的改进](http://www.bio-info-trainee.com/1001.html)

任意给定基因组的 chr:pos, 判断它在哪个基因上面？这个程序难吗？基因的chr,start,end都是已知的 (这个文件需要下载，可以是UCSC，或者NCBI)

学术一点讲述这个问题：已知CNV数据在染色体上的position如chr1:2075000-2930999，怎样批量获取其对应的Gene Symbol呢（批量）

而且还可以更复杂，我不仅想知道自己指定的坐标是否在某个基因上：
如果在基因上，我还想知道在内含子还是外显子，进一步说是第几个外显子或者内含子！
 如果不在基因上，我想知道我指定的坐标距离哪一个基因的TSS(转录起始位点)最近呢？

就是对指定位点或者区间做genomic features的注释！

当然，这个大把的已经造好的轮子可以做到，比如annovar,snpEFF,VEP就是做单个位点注释genomic features的，其它CHIP-seq的软件，都可以做单个区间的批量注释到genomic features！

既然有现成的轮子，我推荐大家去学习一下就好了。

我们的练习题还是简单一点好！

就是指定位置注释是否在基因上面吧

作业：

```
chr7        148697841        148698941
chr7        148698942        148699029
chr7        148699911        148701053
chr7        148701109        148701307
chr7        148701354        148702694
chr7        148703100        148703520
chr7        148703831        148704175
chr7        148704484        148704734
chr7        148704857        148705937
chr7        148706271        148706671
```

首先，拿到上面文件里面每一个区间的序列，然后告诉我该区间是什么基因！
坐标是hg38系统的。
如果你不想写程序，那么熟练使用bedtools就可以了，bedtools这些简单的功能都可以实现。
hg38的基因的起始坐标是：http://www.biotrainee.com/jmzeng/tmp/hg38.tss
因为这个比较复杂，所以我就专门写了一个帖子来做这件事：[perl实现二分法查询最近的坐标](http://www.biotrainee.com/thread-1321-1-1.html)


## 我的答案
1. 首先对 hg38.tss 进行一下预处理：

```
awk '{if($3>0 && $4>0)print $2"\t"$3"\t"$4"\t"$1}' hg38.tss | sort -k1 >sort_hg38.tss
```

```
head sort_hg38.tss
```

```
chr1	100036233	100040233	NM_033055
chr1	100131095	100135095	NM_001304829
chr1	100131095	100135095	NM_194292
chr1	100131150	100135150	NM_019083
chr1	100131150	100135150	NR_135078
chr1	100176273	100180273	NM_001256385
chr1	100176273	100180273	NM_001256386
chr1	100176273	100180273	NM_001256387
chr1	100176273	100180273	NM_144620
chr1	100247853	100251853	NM_001918
```

2. 写个脚本
首先用`for`循环配合`sed`依次取到每一行，用变量保存染色体，起始点，终止点的数据，再用`awk`来比较 test.fa 和 sort_hg38.tss 中的数据，以此来判断该位置是否在基因上，如果是则输出 1 和基因名，反之，则输出 0 。

```
#!/bin/bash
#
for i in {1..10};do
    chr=`sed -n "$i"p test.fa | cut -f1`
    start=`sed -n "$i"p test.fa | cut -f2`
    end=`sed -n "$i"p test.fa | cut -f3`
    grep "\b$chr\b" sort_hg38.tss | awk -v start="$start" -v end="$end" '{if($2<=start && $3>=end){result=1"\t"$4;exit}else result=0}END{print result}' >>result
done
paste test.fa result
```

```
chr7	148697841	148698941	1	NM_003592
chr7	148698942	148699029	1	NM_003592
chr7	148699911	148701053	0
chr7	148701109	148701307	0
chr7	148701354	148702694	0
chr7	148703100	148703520	0
chr7	148703831	148704175	0
chr7	148704484	148704734	0
chr7	148704857	148705937	0
chr7	148706271	148706671	0
```

---

:yum: 我还是一个小小白，平时的笔记一定有不少疏漏之处，恳请各位大佬批评指正！

