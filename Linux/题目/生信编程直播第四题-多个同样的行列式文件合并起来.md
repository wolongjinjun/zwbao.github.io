# 生信编程直播第四题-多个同样的行列式文件合并起来

## 题目

htseq-count是分开对每个样本计算所有的基因表达量，所以会生成一个个独立的文件，用perl脚本模仿它的结果如下：

```
$ head a.txt
gene_1  178
gene_2  692
gene_3  486
gene_4  666
gene_5  395
gene_6  48
gene_7  926
gene_8  733
gene_9  660
gene_10 578
```

第一列是基因，第二列是该基因的counts值，共有a~z这26个样本的counts文件，需要合并成一个大的行列式，这样才能导入到R里面做差异分析，如果手工用excel表格做，当然是可以的，但是太麻烦，如果有500个样本，正常人都不会去手工做了，需要编程。

生成测试文件的代码如下：

- perl

```perl
#首先新建文件tmp.sh 输入这个代码：
perl -le '{print "gene_$_\t".int(rand(1000)) foreach 1..99}'
## 然后用perl脚本调用这个tmp.sh文件：
perl -e 'system(" bash tmp.sh >$_.txt") foreach a..z'
##这样就生成了a~z这26个样本的counts文件
```

- shell

```shell
#!/bin/bash
#
for file in {a..z}.txt;do
    for I in {1..99};do
        echo -e "gene_$I\t$RANDOM" >> $file
    done
done
```

用shell或者perl或者python，设置R语言都可以做，但是各有优缺点，而且如果每个样本的基因顺序并不一致，这时候你应该怎么做呢？

实际需求如下：https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE48213 里面有56个文件(ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE48nnn/GSE48213/suppl/GSE48213_RAW.tar)，需要合并成一个表达矩阵，来根据cell-line的不同，分组做差异分析。

paper是：https://www.ncbi.nlm.nih.gov/pubmed/24176112 

请务必做出此题，很重要！

- 先给一下shell结合R语言的做法：

```shell
## 首先在GSE48213_RAW目录里面生成tmp.txt文件
awk '{print FILENAME"\t"$0}' * |grep -v EnsEMBL_Gene_ID >tmp.txt
## 然后把tmp.txt导入R语言里面用reshape2处理即可！
setwd('tmp/GSE48213_RAW/')
a=read.table('tmp.txt',sep = '\t',stringsAsFactors = F)
library(reshape2)
fpkm <- dcast(a,formula = V2~V1)
```

## 我的答案

1. 生成测试文件：

写一个简单的脚本：先用`for`循环创建文本，再嵌套一个循环，用`$RANDOM`写入随机数。

```shell
#!/bin/bash
#
for file in {a..z}.txt;do
    for I in {1..99};do
        echo -e "gene_$I\t$RANDOM" >> $file
    done
done
```

2. 把行列式合并起来：

用`paste`命令把文件简单合并，但这样基因名会出现多次，所以需要把他们去除，因为基因表达量（随机数）在偶数列，所以可根据此特征输出。

```shell
paste {a..z}.txt |awk '{printf $1"\t";for(i =2;i < NF;i=i+2)printf $i"\t" ;if(i == NF)printf $i"\n"}'
```

效果如下：

```
gene_1	7857	23898	10185	8108	26901	22758	7011	3537	17587	30860	27142	14166	21317	17803	20337	31742	28740	20099	8670	1703	22343	1380	27563	6714	32285	30475
gene_2	10186	28744	9326	4278	6687	1753	9031	20185	1425	2265	25324	16825	3278	30130	22789	2513	13782	15384	9383	30756	8907	3788	18342	7245	23836	20384
gene_3	17920	8202	18671	19810	14540	19669	20657	18450	5427	32154	15027	913	26731	16746	6369	21920	9476	8172	711	8492	31807	16836	666	13875	8477	23139
gene_4	26073	8935	23911	24243	10701	22875	12922	28159	6142	23569	23759	28713	8350	14106	6173	7552	23357	24595	3380	32655	20676	23270	5526	7044	11415	15526
gene_5	10842	1789	15466	24310	32266	12287	10517	8051	28159	7750	29057	24145	9591	18479	14629	4510	13930	19863	2933	24585	11908	31673	1480	6400	13759	3697
gene_6	7007	2952	23788	7948	1705	12026	22254	32216	13442	14882	31452	21211	30112	24250	21218	16369	5632	4831	2677	15487	4264	22669	13850	10913	16567	29508
gene_7	11613	17658	17005	24557	4651	16945	21857	14543	29736	17687	19439	1094	155	17693	17512	12645	8112	4250	24897	27168	11784	11962	14771	31520	28424	12379
gene_8	16324	12027	5478	31321	8073	24751	10964	23314	8772	17385	30100	21453	6149	14803	12263	4462	3496	6353	20460	14481	21500	31351	19198	20318	21321	19083
gene_9	25343	26985	30932	2264	11786	21946	1225	12633	17605	15458	29960	30883	10320	2710	5259	2190	24164	3415	11372	23926	32374	14392	16416	23297	4905	14620
gene_10	24157	3022	14150	16566	28746	18455	28065	31046	5009	32296	8852	23652	26737	14015	29355	17583	14527	2183	14539	5103	6975	11691	9462	15287	16718	4057
gene_11	22684	7734	27992	2961	22856	14458	6866	1137	15386	11363	25783	19465	11397	31692	3006	30405	22072	6463	28468	19839	6769	22853	28745	14148	7991	8059
gene_12	7120	3535	22055	29365	18209	1175	9557	19846	29902	21419	1153	15843	29329	18278	951	17315	21532	12597	26650	10362	15467	32585	26044	5396	3049	6106
gene_13	32054	15085	22887	23436	30409	5129	15677	16432	11206	15758	2629	13695	12670	7083	7059	24077	20834	27838	22096	277	14077	23519	15108	8064	12985	11111
gene_14	29469	23604	3902	947	20031	9429	3931	23081	10221	4322	5570	19462	2563	19069	29484	27818	13904	29376	28218	10376	25930	13657	12705	22793	21757	18750
gene_15	8544	2038	25050	5338	13516	16123	28308	28913	31098	14666	17976	28584	8753	12518	9457	14235	26243	23726	18337	21451	8052	7044	2309	2096	26092	8961
gene_16	12438	24090	12926	17434	3793	4760	4680	4276	3146	38	20603	8508	25114	2095	31969	31294	23730	30435	18384	31896	16124	14585	29762	15118	18133	23703
gene_17	1777	11567	1171	7409	27153	25498	25832	14553	8606	25533	28831	4872	26255	27436	26789	13181	21639	31397	1622	6118	22560	3227	15970	15343	3614	30853
gene_18	28780	642	25137	19560	14122	25865	29794	19822	11000	12260	11894	13246	165	29756	18543	7252	5493	13267	6054	17060	31050	19483	16857	27055	30792	3439
gene_19	32651	11585	14204	7098	29044	25321	7009	8389	10180	22550	25741	19646	5090	12074	4737	4748	1965	1012	25943	19318	3616	17095	15043	3380	692	16814
gene_20	13854	4974	26382	11825	12885	31099	6776	13747	642	20072	9856	29387	2767	8485	9209	31437	17628	12454	58	1557	4491	29878	3988	7225	12425	18229
gene_21	7006	15883	21364	25824	4177	16572	29795	18712	23514	11524	29779	16950	23454	13976	28990	17972	9	9599	1336	6280	28042	3639	5761	12013	8344	14447
gene_22	24114	24026	4010	29709	27166	8711	21047	25823	4295	12788	9026	14278	3209	32735	30511	10007	4492	31812	21994	20308	22342	25120	15199	26702	13968	14916
gene_23	10808	10107	32181	20713	3526	8988	27800	16835	19790	14562	6296	28277	14426	18719	26705	29963	13237	377	20604	16873	22272	25375	8750	4402	30833	2765
gene_24	26083	8183	5255	16728	8102	21138	8383	9949	29843	20997	19192	969	21783	26855	23367	19300	3757	22488	18599	31147	31233	20719	7888	6776	1451	28439
gene_25	17518	8943	14575	7347	8885	12598	2223	12049	10730	3744	539	13011	32432	15400	13239	20124	9793	18958	8064	32476	9434	18021	18407	23779	21612	11347
gene_26	5342	11608	23583	22632	23606	7569	19415	17332	30241	29770	32192	22679	4654	6015	22875	11628	21070	4445	19767	27469	11569	25092	25963	5257	8150	6700
gene_27	10181	30328	5641	28360	14031	30040	17026	7950	16100	17687	7564	16961	21295	15459	14450	19331	14296	10999	5935	22413	16178	19531	32156	20131	18876	5854
gene_28	4465	23723	18321	16712	10277	5632	12590	29339	17421	10951	29945	5733	1024	12834	648	12303	4270	30403	27190	2106	4147	2140	12244	22927	5342	8172
gene_29	18956	6572	1251	11760	26908	2542	158	26976	21970	19112	18661	24875	18995	6059	26333	588	22505	19189	10288	18963	10076	4109	12257	31023	10969	28032
gene_30	27013	29167	2719	3520	1496	16402	18463	21995	8234	3764	20549	8442	13948	7727	30404	8459	17261	25299	7792	965	24981	7350	4141	15298	23574	6964
gene_31	15382	7639	21354	4587	25135	8410	11230	24529	23401	6256	16059	11005	23081	17793	3085	13432	30964	11226	26957	14183	10686	17785	6377	32573	30661	8478
gene_32	21367	15275	28156	7135	6520	30750	22136	20379	27871	3997	10751	31599	28800	24904	23033	20912	12830	7503	6164	32628	9069	24802	8677	8341	28319	1359
gene_33	14459	25213	30283	202	13171	18596	14893	981	32719	14805	23173	369	4008	4750	10145	22594	11325	2760	3954	15463	2894	15961	2858	24544	15772	9007
gene_34	15305	9238	21983	30877	27870	17055	1563	25718	11024	30265	2155	25945	7280	29854	30756	12661	9081	1506	15594	15010	29698	2556	15730	15473	2664	5155
gene_35	8456	16366	18660	10999	8472	31715	7275	21330	26580	25180	19534	26107	11148	22119	22971	10482	7374	29410	20563	16441	25697	11243	19119	17514	29505	15220
gene_36	8117	9274	9071	3680	3154	17015	1681	25597	19490	16129	13409	28182	10016	21894	11698	24210	15572	11438	21275	31976	18167	31313	32268	23780	23743	32258
gene_37	19301	4699	20404	2058	3472	17066	29350	9331	6028	4539	4479	17243	28132	7506	23448	1382	14777	5218	21343	10266	20913	4522	764	16396	10788	31335
gene_38	24127	19725	26457	4755	16976	32721	9228	19117	1530	14992	32513	18261	27012	20245	30860	18553	28664	29470	14132	29230	3328	20511	16633	2939	29869	24063
gene_39	13885	4651	12384	6057	23117	4776	15251	25391	9420	2938	21305	28409	13393	8853	26274	12620	20502	31477	24005	19523	14952	23578	29140	5651	20376	27011
gene_40	31541	31006	3892	2803	18036	75	27369	23861	7081	6059	28936	26427	30935	892	14407	12406	10267	12527	31435	7937	22062	21978	22140	28635	22653	29604
gene_41	24729	8353	20783	5610	14885	32295	11776	7748	6935	1349	2090	3706	3409	7155	25398	15574	13833	22500	17821	11889	9579	11303	13844	24399	18402	28326
gene_42	7507	17036	27793	30625	31176	24099	15815	20449	9803	6495	11281	6091	7972	16309	16381	14267	18709	26729	8075	11013	20937	28495	13382	23110	30036	7355
gene_43	28258	30791	23744	13690	4356	31914	4819	23632	12205	28038	19594	22377	15280	19949	10549	11647	22280	32508	5598	32718	3620	25244	32137	22430	8604	25912
gene_44	30551	1586	25266	1463	24881	20905	3891	24276	10717	16914	11073	26548	25785	16197	6807	14455	31025	6447	23485	26930	4687	17580	24734	30044	25444	441
gene_45	9472	27448	12396	26394	5523	1730	14327	27138	5233	32436	30429	2549	21268	31462	25190	20321	12794	741	4729	10916	18656	18600	408	12808	26351	25619
gene_46	19411	15241	5984	13986	3478	30577	491	31556	19188	5245	22452	696	8083	28025	17242	17993	20869	20990	31872	9846	12883	19764	17683	28021	8641	14701
gene_47	17191	15946	23523	4060	17729	21666	8320	90	5572	21907	9891	21698	2406	22700	9704	11541	15828	10648	32441	12990	6957	24633	8440	17103	23168	24266
gene_48	20967	4806	19170	2178	31634	987	25535	25308	10629	28297	29004	24518	25287	12277	27709	6127	19413	4131	32089	4378	19311	5333	15666	28505	12426	22855
gene_49	18328	4396	15430	19197	20963	29274	27748	11042	10224	16915	29324	25821	7439	12881	17161	30973	26251	11643	6901	30800	5075	27025	18163	29507	24613	32713
gene_50	21656	27144	7481	31454	26857	15969	29186	6555	8435	15002	1123	12943	30921	5737	10949	22572	22581	7903	417	2609	14835	24695	13879	27743	17232	10908
gene_51	18265	14456	9797	18197	16170	28870	11626	12327	1877	10832	7835	32008	10074	4893	11189	32204	13560	4494	15294	17543	21857	26632	6421	1096	25053	13850
gene_52	24721	20608	6886	28143	14169	7780	20635	2828	11074	10918	31228	19232	17682	9592	22011	9563	21192	13981	28577	7857	31029	4561	1319	26286	16889	6052
gene_53	24564	16512	2094	15616	806	24202	4449	27619	20648	12765	15128	16141	29963	15337	2375	12478	5874	18089	26498	8167	10258	1084	4987	24573	24551	18487
gene_54	9455	8130	13185	4288	24203	2598	18238	12215	6762	26228	26923	5440	17894	2968	13068	25466	11351	16815	24407	14711	31026	21646	15837	2062	30300	14130
gene_55	30702	8753	23677	28290	13719	4721	30544	23859	24265	29603	18565	22272	8550	23720	30739	11208	18695	27253	1241	1725	31957	31781	21731	31427	27895	3329
gene_56	22135	27077	15972	22544	9184	3900	23931	3188	14692	10366	25128	26062	20161	19142	25045	2805	18063	23904	31186	14583	21842	4680	21633	24586	31009	28072
gene_57	17521	11648	17885	9008	30927	31686	24726	21014	622	12126	34	31456	11554	11916	14234	32295	3106	6032	32060	2895	10981	32191	13100	25425	16458	20328
gene_58	22991	25615	21870	316	10812	23563	27283	19285	21623	7827	28766	10727	22280	5937	13825	23086	16538	4848	14244	9022	25065	25668	21918	5947	31565	1251
gene_59	10632	16846	14137	14934	5581	442	5018	30176	4270	27113	23443	8927	8054	22493	18818	21717	28540	26736	17551	1769	9835	23418	21985	21606	12779	11308
gene_60	19220	19643	10381	13974	5853	7207	4035	29260	21979	873	22505	13368	8699	18736	13408	16652	25591	21109	18869	28068	6401	26632	23328	11143	1369	11510
gene_61	19920	9197	27632	25895	10149	30606	6623	11752	28649	9794	19927	7028	16901	18086	24003	9899	17131	16920	12880	29794	25419	15441	24295	31185	25168	7182
gene_62	17550	10926	549	7130	29572	17252	18213	13882	31262	3669	13494	5070	12344	4088	32317	18615	32021	23350	32008	4664	4386	12852	24119	23326	5345	6020
gene_63	21491	1423	2536	11651	7049	30535	29193	20266	5203	14537	21774	22870	27318	13851	30295	6892	12040	31874	29575	26865	30274	15099	13427	12753	7839	12996
gene_64	5019	2799	31568	8203	29140	10102	2549	11424	5662	16791	15479	30934	8552	20059	26683	9764	29035	31447	17797	30180	11088	24349	11824	12253	8400	9805
gene_65	14940	23308	19547	31050	28700	21894	24934	31967	13461	30147	30321	30827	27541	872	11971	24100	31097	3821	15868	3980	12445	8523	1137	13467	22623	24219
gene_66	11387	10469	6467	10493	5214	32122	10510	23963	25676	169	17194	31799	23753	27470	20808	20484	12926	14523	16323	26970	13770	3504	26742	28631	8060	19240
gene_67	17513	32562	9191	19199	25969	1034	1586	14295	26298	13675	18057	8928	14704	3707	2387	23380	11365	12718	27224	24573	4892	19796	18107	14611	19452	23484
gene_68	30184	16044	11558	30268	8228	18906	23221	22345	29273	13076	30427	31758	12536	2307	23834	5610	20651	23893	26309	1081	28544	28554	30523	19987	27154	17375
gene_69	21417	16883	15801	9909	30827	17680	31404	7511	24718	9083	27532	17242	16688	31201	797	2712	12173	8467	22406	2953	24189	9289	32257	2940	25702	16967
gene_70	7003	14883	17421	29448	32389	17953	24163	3927	14628	2502	22709	3315	26063	18615	11140	14028	9738	16236	18525	2332	3219	28922	7913	10747	11260	6437
gene_71	31292	25581	14176	25614	30832	25729	24308	19191	16704	29253	6584	19058	8468	8423	3410	21410	14257	1529	3647	11680	16035	2764	8409	25979	32635	9500
gene_72	32289	907	10447	28947	20219	1981	13615	16144	30906	22502	9003	20221	25689	27579	21805	1720	3235	27023	10278	13511	7093	5929	20796	4376	509	9606
gene_73	16898	12357	23944	15341	28840	12614	23910	2590	22877	30108	9395	2166	25972	6896	11519	23286	27839	19577	5800	18953	23544	20215	30417	22	13136	15564
gene_74	15942	2861	13317	6076	32721	4175	32436	28044	2738	32120	3001	14607	31066	22403	20537	698	15080	24094	9164	16007	19839	31042	22934	27363	32464	11342
gene_75	8152	20870	27892	25753	13327	31722	11985	21990	2012	8378	24050	9948	11751	13089	10482	20351	12811	18512	19904	21361	5602	5352	15172	2419	16380	4798
gene_76	20157	28466	12456	22371	28402	5299	20092	6149	17505	27571	5035	31321	19700	26066	21165	16218	5904	21270	8800	24959	26169	19829	5208	8568	23874	6969
gene_77	26363	21961	6133	31169	4385	4201	30377	7258	28036	3838	29684	15872	27475	1088	9635	1339	17274	31346	4313	1908	1228	23360	20316	8349	21965	24256
gene_78	5246	5260	3636	10610	16606	155	9841	4038	15759	6041	16822	8786	26468	19929	8657	9563	20610	4236	20020	8045	18574	28552	31515	16388	18063	15233
gene_79	5641	9074	3065	13011	1047	4184	3723	21779	18542	31806	19056	29190	8775	13485	27267	18127	21662	7919	3113	22354	11345	29760	385	2855	31669	17798
gene_80	18287	14111	14495	25198	12915	19790	26114	5040	31289	32094	22709	15733	11580	1260	27302	934	124	9758	57	3055	17143	26196	3680	27976	17958	14331
gene_81	2288	27056	24409	28718	21674	4050	23355	20089	26380	23298	28616	5341	29203	32278	25325	9990	30097	10659	20898	9067	13749	19855	28862	22570	14906	29718
gene_82	19985	24281	27676	32677	10466	20616	20748	15944	384	7584	3373	2382	31174	31978	28661	10269	22640	17470	12973	7410	17671	8600	3352	32008	27398	30662
gene_83	15919	1676	24984	32659	14459	11968	12755	16625	8255	9093	21231	1476	1691	4787	6379	23486	30828	1666	7993	1503	32294	22689	27114	26842	6738	9786
gene_84	4335	2054	29627	22798	16232	30813	18593	14511	17601	8220	32672	24113	18931	31444	5076	16370	11171	2968	9711	17167	7412	39	23530	4572	15875	407
gene_85	22231	24051	13094	19983	103	21936	4406	10580	4667	13656	3192	16578	14680	10281	374	28426	4582	28889	15163	11883	6707	12756	4467	8689	30468	32019
gene_86	19730	10264	14083	5822	12695	15876	4972	27432	1393	22988	17109	7786	25997	21673	7502	5978	18662	4027	24178	10994	21839	4566	26862	1299	28261	3624
gene_87	32634	19459	24871	28086	24857	22173	27496	24806	569	1312	20258	458	22615	21539	10539	15883	18507	28040	23354	15165	2119	12775	11409	23877	27739	3315
gene_88	21220	30272	31299	28802	31959	3898	13666	24037	9703	12023	7744	18494	1032	67	4437	3729	25212	21317	1602	25761	12036	25109	12019	384	9842	17521
gene_89	1550	27845	19770	5060	10155	32625	1700	5195	2096	10201	7668	8541	20521	2069	15419	7441	29181	6829	9966	17752	21096	5117	2893	15415	22274	10195
gene_90	10998	32728	17738	25165	28601	29704	11458	8925	23372	28176	14693	13428	3875	16228	30764	31555	21699	11504	3162	19785	32050	30006	6843	30823	7882	23705
gene_91	12230	28949	6673	25955	9109	1931	19298	1798	9011	10268	15609	25730	4816	30899	27931	18946	27621	28748	4922	6424	6647	23376	13094	29078	6611	24757
gene_92	30286	14799	3751	25946	26203	28142	24892	16867	16192	26085	10932	21996	23562	29695	24091	3618	21572	22273	28864	19795	23202	5966	17017	3131	12574	14075
gene_93	5716	19440	6164	17628	6391	17313	1938	26049	22117	17227	14370	16865	22710	7733	32121	8502	23940	22270	7278	20919	7156	10059	21488	11333	25271	24034
gene_94	31183	8436	26846	2197	14411	13339	19689	7143	13093	6979	26493	28049	17588	24549	15832	11393	18373	4966	8329	8912	29745	780	31159	13685	2456	17891
gene_95	12887	4358	27892	13680	8138	32418	31263	9293	194	1296	6336	7698	14081	25998	23729	26840	4457	21676	23841	24792	28623	22191	8243	16470	11206	27259
gene_96	6317	19613	12967	7490	9256	457	16088	28445	1309	9164	8914	1516	18202	30555	8999	32386	11031	7653	26123	20030	21532	13063	4954	30713	7385	28425
gene_97	12623	23906	11206	10406	5971	26042	9640	12441	24673	31919	9995	7727	10161	14464	30577	25117	16383	23350	5115	5489	20990	27029	7422	18067	4624	28364
gene_98	23659	1258	1060	28474	2311	18727	2579	22043	23599	30981	32448	22803	7974	5474	25718	10473	9846	31949	936	32210	17394	3755	3337	6066	3315	27363
gene_99	3120	14593	6005	26306	22102	21994	6174	24061	22477	32656	14905	15802	15512	30355	19342	8412	20986	20703	16727	12519	316
```

---
:yum: 我还是一个小小白，平时的笔记一定有不少疏漏之处，恳请各位大佬批评指正！
